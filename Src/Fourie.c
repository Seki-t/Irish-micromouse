#include"Fourie.h"
#include "IrSensor.h"

float fourie_results[4] = {0,0,0,0};

float* caluculateFourie(uint16_t* dma_buffer){

  for (int i = 0; i < 4; i++) {
    float cos_sum = 0;
    float sin_sum = 0;
    for (int k = 0; k < PULSE_NUM * SUMPLE_FOR_PULSE; k++) {
      cos_sum += cos_arr[k] * (float)dma_buffer[4 * k + i];
      sin_sum += - sin_arr[k] * (float)dma_buffer[4 * k + i];
    }
    fourie_results[i] = sqrt(cos_sum * cos_sum + sin_sum * sin_sum);
  }

  return fourie_results;
}

const float cos_arr[PULSE_NUM * SUMPLE_FOR_PULSE] = {
1,
0.9510565163,
0.8090169944,
0.5877852523,
0.3090169944,
0,
-0.3090169944,
-0.5877852523,
-0.8090169944,
-0.9510565163,
-1,
-0.9510565163,
-0.8090169944,
-0.5877852523,
-0.3090169944,
0,
0.3090169944,
0.5877852523,
0.8090169944,
0.9510565163,
1,
0.9510565163,
0.8090169944,
0.5877852523,
0.3090169944,
0,
-0.3090169944,
-0.5877852523,
-0.8090169944,
-0.9510565163,
-1,
-0.9510565163,
-0.8090169944,
-0.5877852523,
-0.3090169944,
0,
0.3090169944,
0.5877852523,
0.8090169944,
0.9510565163,
1,
0.9510565163,
0.8090169944,
0.5877852523,
0.3090169944,
0,
-0.3090169944,
-0.5877852523,
-0.8090169944,
-0.9510565163,
-1,
-0.9510565163,
-0.8090169944,
-0.5877852523,
-0.3090169944,
0,
0.3090169944,
0.5877852523,
0.8090169944,
0.9510565163,
1,
0.9510565163,
0.8090169944,
0.5877852523,
0.3090169944,
0,
-0.3090169944,
-0.5877852523,
-0.8090169944,
-0.9510565163,
-1,
-0.9510565163,
-0.8090169944,
-0.5877852523,
-0.3090169944,
0,
0.3090169944,
0.5877852523,
0.8090169944,
0.9510565163
};

const float sin_arr[PULSE_NUM * SUMPLE_FOR_PULSE] = {
0,
-0.3090169944,
-0.5877852523,
-0.8090169944,
-0.9510565163,
-1,
-0.9510565163,
-0.8090169944,
-0.5877852523,
-0.3090169944,
0,
0.3090169944,
0.5877852523,
0.8090169944,
0.9510565163,
1,
0.9510565163,
0.8090169944,
0.5877852523,
0.3090169944,
0,
-0.3090169944,
-0.5877852523,
-0.8090169944,
-0.9510565163,
-1,
-0.9510565163,
-0.8090169944,
-0.5877852523,
-0.3090169944,
0,
0.3090169944,
0.5877852523,
0.8090169944,
0.9510565163,
1,
0.9510565163,
0.8090169944,
0.5877852523,
0.3090169944,
0,
-0.3090169944,
-0.5877852523,
-0.8090169944,
-0.9510565163,
-1,
-0.9510565163,
-0.8090169944,
-0.5877852523,
-0.3090169944,
0,
0.3090169944,
0.5877852523,
0.8090169944,
0.9510565163,
1,
0.9510565163,
0.8090169944,
0.5877852523,
0.3090169944,
0,
-0.3090169944,
-0.5877852523,
-0.8090169944,
-0.9510565163,
-1,
-0.9510565163,
-0.8090169944,
-0.5877852523,
-0.3090169944,
0,
0.3090169944,
0.5877852523,
0.8090169944,
0.9510565163,
1,
0.9510565163,
0.8090169944,
0.5877852523,
0.3090169944
};
